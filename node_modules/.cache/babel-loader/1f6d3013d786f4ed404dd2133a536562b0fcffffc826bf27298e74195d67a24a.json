{"ast":null,"code":"import { asyncToGenerator as _asyncToGenerator, regeneratorRuntime as _regeneratorRuntime } from './_virtual/_rollupPluginBabelHelpers.js';\nimport { AppConfig, UserSession } from '@stacks/auth';\nimport { decodeToken } from 'jsontokens';\nimport { getStacksProvider } from './utils.esm.js';\nvar defaultAuthURL = \"https://app.blockstack.org\";\nvar version = \"7.1.1\";\nif (typeof window !== \"undefined\") {\n  window.__CONNECT_VERSION__ = version;\n}\nvar isMobile = function isMobile() {\n  var ua = navigator.userAgent;\n  if (/android/i.test(ua)) {\n    return true;\n  }\n  if (/iPad|iPhone|iPod/.test(ua)) {\n    return true;\n  }\n  return /windows phone/i.test(ua);\n};\nvar shouldUsePopup = function shouldUsePopup() {\n  return !isMobile();\n};\nvar getOrCreateUserSession = function getOrCreateUserSession(userSession) {\n  if (!userSession) {\n    var appConfig = new AppConfig([\"store_write\"], document.location.href);\n    userSession = new UserSession({\n      appConfig: appConfig\n    });\n  }\n  return userSession;\n};\nvar authenticate = /*#__PURE__*/function () {\n  var _ref = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(authOptions) {\n    var provider, _authOptions$redirect, redirectTo, manifestPath, onFinish, onCancel, _authOptions$sendToSi, sendToSignIn, _userSession, appDetails, userSession, transitKey, authRequest, authResponse, token, payload, authResponsePayload;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          provider = getStacksProvider();\n          if (provider) {\n            _context.next = 3;\n            break;\n          }\n          throw new Error(\"Unable to authenticate without Hiro Wallet extension\");\n        case 3:\n          _authOptions$redirect = authOptions.redirectTo, redirectTo = _authOptions$redirect === void 0 ? \"/\" : _authOptions$redirect, manifestPath = authOptions.manifestPath, onFinish = authOptions.onFinish, onCancel = authOptions.onCancel, _authOptions$sendToSi = authOptions.sendToSignIn, sendToSignIn = _authOptions$sendToSi === void 0 ? false : _authOptions$sendToSi, _userSession = authOptions.userSession, appDetails = authOptions.appDetails;\n          userSession = getOrCreateUserSession(_userSession);\n          if (userSession.isUserSignedIn()) {\n            userSession.signUserOut();\n          }\n          transitKey = userSession.generateAndStoreTransitKey();\n          authRequest = userSession.makeAuthRequest(transitKey, \"\" + document.location.origin + redirectTo, \"\" + document.location.origin + manifestPath, userSession.appConfig.scopes, void 0, void 0, {\n            sendToSignIn: sendToSignIn,\n            appDetails: appDetails,\n            connectVersion: version\n          });\n          _context.prev = 8;\n          _context.next = 11;\n          return provider.authenticationRequest(authRequest);\n        case 11:\n          authResponse = _context.sent;\n          _context.next = 14;\n          return userSession.handlePendingSignIn(authResponse);\n        case 14:\n          token = decodeToken(authResponse);\n          payload = token == null ? void 0 : token.payload;\n          authResponsePayload = payload;\n          onFinish == null ? void 0 : onFinish({\n            authResponse: authResponse,\n            authResponsePayload: authResponsePayload,\n            userSession: userSession\n          });\n          _context.next = 24;\n          break;\n        case 20:\n          _context.prev = 20;\n          _context.t0 = _context[\"catch\"](8);\n          console.error(\"[Connect] Error during auth request\", _context.t0);\n          onCancel == null ? void 0 : onCancel();\n        case 24:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee, null, [[8, 20]]);\n  }));\n  return function authenticate(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar getUserData = /*#__PURE__*/function () {\n  var _ref2 = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(userSession) {\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          userSession = getOrCreateUserSession(userSession);\n          if (!userSession.isUserSignedIn()) {\n            _context2.next = 3;\n            break;\n          }\n          return _context2.abrupt(\"return\", userSession.loadUserData());\n        case 3:\n          if (!userSession.isSignInPending()) {\n            _context2.next = 5;\n            break;\n          }\n          return _context2.abrupt(\"return\", userSession.handlePendingSignIn());\n        case 5:\n          return _context2.abrupt(\"return\", null);\n        case 6:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return function getUserData(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport { authenticate, defaultAuthURL, getOrCreateUserSession, getUserData, isMobile, shouldUsePopup };","map":{"version":3,"names":["defaultAuthURL","version","window","__CONNECT_VERSION__","isMobile","ua","navigator","userAgent","test","shouldUsePopup","getOrCreateUserSession","userSession","appConfig","AppConfig","document","location","href","UserSession","authenticate","_callee","authOptions","provider","getStacksProvider","Error","redirectTo","_authOptions$redirect","manifestPath","onFinish","onCancel","_authOptions$sendToSi","sendToSignIn","_userSession","appDetails","isUserSignedIn","signUserOut","transitKey","generateAndStoreTransitKey","authRequest","makeAuthRequest","origin","scopes","connectVersion","authenticationRequest","authResponse","_context","sent","handlePendingSignIn","token","decodeToken","payload","authResponsePayload","error","t0","_x","getUserData","_callee2","loadUserData","isSignInPending","_x2"],"sources":["C:\\Users\\abasi\\Desktop\\web3-apps\\react-cra\\node_modules\\@stacks\\connect-react\\node_modules\\@stacks\\connect\\src\\auth.ts"],"sourcesContent":["import { AppConfig, UserSession } from '@stacks/auth';\nimport { decodeToken } from 'jsontokens';\nimport type { AuthOptions, AuthResponsePayload } from './types';\n\nimport { getStacksProvider } from './utils';\n\nexport const defaultAuthURL = 'https://app.blockstack.org';\n\nconst version = __VERSION__;\n\nif (typeof window !== 'undefined') {\n  window.__CONNECT_VERSION__ = version;\n}\n\nexport const isMobile = () => {\n  const ua = navigator.userAgent;\n  if (/android/i.test(ua)) {\n    return true;\n  }\n  if (/iPad|iPhone|iPod/.test(ua)) {\n    return true;\n  }\n  return /windows phone/i.test(ua);\n};\n\n/**\n * mobile should not use a 'popup' type of window.\n */\nexport const shouldUsePopup = () => {\n  return !isMobile();\n};\n\nexport const getOrCreateUserSession = (userSession?: UserSession): UserSession => {\n  if (!userSession) {\n    const appConfig = new AppConfig(['store_write'], document.location.href);\n    userSession = new UserSession({ appConfig });\n  }\n  return userSession;\n};\n\nexport const authenticate = async (authOptions: AuthOptions) => {\n  const provider = getStacksProvider();\n  if (!provider) {\n    throw new Error('Unable to authenticate without Hiro Wallet extension');\n  }\n\n  const {\n    redirectTo = '/',\n    manifestPath,\n    onFinish,\n    onCancel,\n    sendToSignIn = false,\n    userSession: _userSession,\n    appDetails,\n  } = authOptions;\n  const userSession = getOrCreateUserSession(_userSession);\n  if (userSession.isUserSignedIn()) {\n    userSession.signUserOut();\n  }\n  const transitKey = userSession.generateAndStoreTransitKey();\n  const authRequest = userSession.makeAuthRequest(\n    transitKey,\n    `${document.location.origin}${redirectTo}`,\n    `${document.location.origin}${manifestPath}`,\n    userSession.appConfig.scopes,\n    undefined,\n    undefined,\n    {\n      sendToSignIn,\n      appDetails,\n      connectVersion: version,\n    }\n  );\n\n  try {\n    const authResponse = await provider.authenticationRequest(authRequest);\n    await userSession.handlePendingSignIn(authResponse);\n    const token = decodeToken(authResponse);\n    const payload = token?.payload;\n    const authResponsePayload = payload as unknown as AuthResponsePayload;\n    onFinish?.({\n      authResponse,\n      authResponsePayload,\n      userSession,\n    });\n  } catch (error) {\n    console.error('[Connect] Error during auth request', error);\n    onCancel?.();\n  }\n};\n\n// eslint-disable-next-line @typescript-eslint/require-await\nexport const getUserData = async (userSession?: UserSession) => {\n  userSession = getOrCreateUserSession(userSession);\n  if (userSession.isUserSignedIn()) {\n    return userSession.loadUserData();\n  }\n  if (userSession.isSignInPending()) {\n    return userSession.handlePendingSignIn();\n  }\n  return null;\n};\n"],"mappings":";;;;IAMaA,cAAA,GAAiB;AAE9B,IAAMC,OAAA,GAAU;AAEhB,IAAI,OAAOC,MAAA,KAAW,aAAa;SAC1BC,mBAAA,GAAsBF,OAAA;AAAA;IAGlBG,QAAA,GAAW,SAAXA,SAAA,EAAiB;MACtBC,EAAA,GAAKC,SAAA,CAAUC,SAAA;MACjB,WAAWC,IAAA,CAAKH,EAAA,GAAK;WAChB;;MAEL,mBAAmBG,IAAA,CAAKH,EAAA,GAAK;WACxB;;SAEF,iBAAiBG,IAAA,CAAKH,EAAA;AAAA;IAMlBI,cAAA,GAAiB,SAAjBA,eAAA,EAAuB;SAC3B,CAACL,QAAA;AAAA;IAGGM,sBAAA,GAAyB,SAAzBA,uBAA0BC,WAAA,EAA2C;MAC5E,CAACA,WAAA,EAAa;QACVC,SAAA,GAAY,IAAIC,SAAA,CAAU,CAAC,gBAAgBC,QAAA,CAASC,QAAA,CAASC,IAAA;kBACrD,IAAIC,WAAA,CAAY;MAAEL,SAAA,EAAAA;;;SAE3BD,WAAA;AAAA;IAGIO,YAAA;qFAAe,SAAAC,QAAOC,WAAA;;;;;UAC3BC,QAAA,GAAWC,iBAAA;cACZD,QAAA;;;;gBACG,IAAIE,KAAA,CAAM;;kCAWdH,WAAA,CAPFI,UAAA,EAAAA,UAAA,GAAAC,qBAAA,cAAa,MAAAA,qBAAA,EACbC,YAAA,GAMEN,WAAA,CANFM,YAAA,EACAC,QAAA,GAKEP,WAAA,CALFO,QAAA,EACAC,QAAA,GAIER,WAAA,CAJFQ,QAAA,EAAAC,qBAAA,GAIET,WAAA,CAHFU,YAAA,EAAAA,YAAA,GAAAD,qBAAA,cAAe,QAAAA,qBAAA,EACFE,YAAA,GAEXX,WAAA,CAFFT,WAAA,EACAqB,UAAA,GACEZ,WAAA,CADFY,UAAA;UAEIrB,WAAA,GAAcD,sBAAA,CAAuBqB,YAAA;cACvCpB,WAAA,CAAYsB,cAAA,IAAkB;wBACpBC,WAAA;;UAERC,UAAA,GAAaxB,WAAA,CAAYyB,0BAAA;UACzBC,WAAA,GAAc1B,WAAA,CAAY2B,eAAA,CAC9BH,UAAA,OACGrB,QAAA,CAASC,QAAA,CAASwB,MAAA,GAASf,UAAA,OAC3BV,QAAA,CAASC,QAAA,CAASwB,MAAA,GAASb,YAAA,EAC9Bf,WAAA,CAAYC,SAAA,CAAU4B,MAAA,EACtB,QACA,QACA;YACEV,YAAA,EAAAA,YAAA;YACAE,UAAA,EAAAA,UAAA;YACAS,cAAA,EAAgBxC;;;;iBAKSoB,QAAA,CAASqB,qBAAA,CAAsBL,WAAA;;UAApDM,YAAA,GAAAC,QAAA,CAAAC,IAAA;;iBACAlC,WAAA,CAAYmC,mBAAA,CAAoBH,YAAA;;UAChCI,KAAA,GAAQC,WAAA,CAAYL,YAAA;UACpBM,OAAA,GAAUF,KAAA,oBAAAA,KAAA,CAAOE,OAAA;UACjBC,mBAAA,GAAsBD,OAAA;+CACjB;YACTN,YAAA,EAAAA,YAAA;YACAO,mBAAA,EAAAA,mBAAA;YACAvC,WAAA,EAAAA;;;;;;;kBAGMwC,KAAA,CAAM,uCAAAP,QAAA,CAAAQ,EAAA;;;;;;;;kBA9CLlC,aAAAmC,EAAA;;;;IAoDAC,WAAA;sFAAc,SAAAC,SAAO5C,WAAA;;;;wBAClBD,sBAAA,CAAuBC,WAAA;eACjCA,WAAA,CAAYsB,cAAA;;;;4CACPtB,WAAA,CAAY6C,YAAA;;eAEjB7C,WAAA,CAAY8C,eAAA;;;;4CACP9C,WAAA,CAAYmC,mBAAA;;4CAEd;;;;;;;kBARIQ,YAAAI,GAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}